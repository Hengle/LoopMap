# Unity  循环地图实现(LoopMap)

---------------

## 操作

上下左右按钮控制玩家位置，以测试地图变化。

--------------

## 结构

一系列块（block）组成一个层（layer）:

- 层：包含多个块，每个块大小一致，二位矩阵填充。
- 块：包含x, y坐标，其ID可以理解为二位坐标转换成一维坐标的值。

-------------------

## 原理

- 最开始记录下玩家所在块索引。

- 每次更新时：

  - `blockOffset` ：计算当前玩家所在索引和最开始的索引的偏移量。
  - `blockInLayerOffset` ：计算块相对于层的偏移量，即`blockOffset`对块数量求余。

  - `layerOffset` ：层偏移量，即玩家移到超过整个原始地图大小的次数。

- 遍历所有块（举例x坐标）：

  - 如果`blockOffset.x`大于0，说明玩家往 x正半轴 移动。
    - 且如果计算的当前块，x坐标小于`blockInLayerOffset`，即x索引小的块，说明这个块是要被移到前方的。（可以理解为往前走一格，最后一排的格子就要挪到最前面）
  - 反之玩家往负方向同理。
  - 剩余不在偏移范围内的块，也需要重置位置。



----









